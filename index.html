<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹å‹•é¡é ­é¸æ“‡å™¨</title>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; padding: 10px; text-align: center; }
        
        /* æ”å½±æ©Ÿåˆ—è¡¨å€åŸŸ */
        #camera-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 15px;
            font-size: 16px;
            background: #333;
            color: white;
            border: 1px solid #555;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
        }
        button:hover { background: #444; }
        button.active { background: #007bff; border-color: #0056b3; }

        /* é è¦½ç•«é¢ */
        .video-container {
            width: 100%;
            height: 60vh;
            background: #111;
            border: 2px solid #333;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        video { 
            width: 100%; 
            height: 100%; 
            object-fit: contain; 
        }

        /* ç‹€æ…‹ç‡ˆ (è­‰æ˜ç¨‹å¼æ²’æ­»ç•¶) */
        .blinker {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 10px;
            height: 10px;
            background: #0f0;
            border-radius: 50%;
            animation: blink 1s infinite;
            z-index: 10;
        }
        @keyframes blink { 50% { opacity: 0; } }

        #log { 
            margin-top: 20px; 
            font-size: 12px; 
            color: #aaa; 
            text-align: left; 
            white-space: pre-wrap;
            border-top: 1px solid #333;
            padding-top: 10px;
        }
    </style>
</head>
<body>

    <h3>è«‹æ‰‹å‹•é¸æ“‡ä¸€å€‹é¡é ­ï¼š</h3>
    <div id="camera-list">
        <button onclick="requestPermission()">âš ï¸ é»æ­¤å…ˆæˆæ¬Šç›¸æ©Ÿæ¬Šé™ (ç¬¬ä¸€æ­¥)</button>
    </div>

    <div class="video-container">
        <div class="blinker"></div>
        <video id="preview" autoplay playsinline muted></video>
    </div>

    <div id="log">ç­‰å¾…æ“ä½œ...</div>

<script>
    const cameraListDiv = document.getElementById('camera-list');
    const video = document.getElementById('preview');
    const logDiv = document.getElementById('log');
    let currentStream = null;

    function log(msg) {
        logDiv.innerText = msg + "\n" + logDiv.innerText;
    }

    // ç¬¬ä¸€æ­¥ï¼šå…ˆéš¨ä¾¿è«‹æ±‚ä¸€å€‹æ¬Šé™ï¼Œç‚ºäº†æ‹¿åˆ°è£ç½®åˆ—è¡¨
    async function requestPermission() {
        try {
            log("æ­£åœ¨è«‹æ±‚æ¬Šé™...");
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            
            // æ¬Šé™æ‹¿åˆ°å¾Œé¦¬ä¸Šé—œæ‰ï¼Œæˆ‘å€‘åªæ˜¯è¦è§¸ç™¼ç€è¦½å™¨çš„ã€Œå…è¨±ã€
            stream.getTracks().forEach(t => t.stop());
            
            log("æ¬Šé™å·²ç²å–ï¼Œæ­£åœ¨åˆ—å‡ºè£ç½®...");
            listCameras();
        } catch (e) {
            log("âŒ æ¬Šé™è«‹æ±‚å¤±æ•—: " + e.message);
            alert("ç„¡æ³•ç²å–ç›¸æ©Ÿæ¬Šé™ï¼Œè«‹ç¢ºèªç¶²å€åˆ—çš„é–é ­åœ–ç¤ºæ˜¯å¦å·²å°é–ã€‚");
        }
    }

    // ç¬¬äºŒæ­¥ï¼šåˆ—å‡ºæ‰€æœ‰é¡é ­
    async function listCameras() {
        try {
            // åˆ—å‡ºæ‰€æœ‰åª’é«”è£ç½®
            const devices = await navigator.mediaDevices.enumerateDevices();
            const videoDevices = devices.filter(device => device.kind === 'videoinput');

            if (videoDevices.length === 0) {
                log("âŒ æ‰¾ä¸åˆ°ä»»ä½•æ”å½±æ©Ÿè£ç½®ï¼");
                return;
            }

            cameraListDiv.innerHTML = ''; // æ¸…ç©ºåˆ—è¡¨
            
            videoDevices.forEach((device, index) => {
                const btn = document.createElement('button');
                // å¦‚æœè£ç½®æ²’åå­—(é€šå¸¸æ˜¯å› ç‚ºæ¬Šé™å‰›é)ï¼Œå°±çµ¦å€‹ä»£è™Ÿ
                const label = device.label || `æ”å½±æ©Ÿ ${index + 1} (æœªçŸ¥å‹è™Ÿ)`;
                
                btn.innerText = `ğŸ¥ ${label}`;
                btn.onclick = () => startCamera(device.deviceId, btn);
                cameraListDiv.appendChild(btn);
            });
            
            log(`æ‰¾åˆ° ${videoDevices.length} å€‹é¡é ­ï¼Œè«‹é»æ“Šä¸Šæ–¹æŒ‰éˆ•æ¸¬è©¦ã€‚`);

        } catch (e) {
            log("åˆ—å‡ºè£ç½®å¤±æ•—: " + e.message);
        }
    }

    // ç¬¬ä¸‰æ­¥ï¼šå•Ÿå‹•ç‰¹å®šé¡é ­
    async function startCamera(deviceId, btnElement) {
        // æ›´æ–°æŒ‰éˆ•æ¨£å¼
        document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
        btnElement.classList.add('active');

        // åœæ­¢ç›®å‰çš„ä¸²æµ
        if (currentStream) {
            currentStream.getTracks().forEach(t => t.stop());
        }

        log(`æ­£åœ¨å•Ÿå‹•é¡é ­ ID: ${deviceId.substring(0, 10)}...`);

        try {
            const constraints = {
                video: {
                    deviceId: { exact: deviceId } // å¼·åˆ¶æŒ‡å®šé€™å€‹ ID
                }
            };

            const stream = await navigator.mediaDevices.getUserMedia(constraints);
            currentStream = stream;
            video.srcObject = stream;
            
            log("âœ… è¨Šè™Ÿå·²é€£æ¥ï¼å¦‚æœç•«é¢é‚„æ˜¯é»‘çš„ï¼Œä»£è¡¨æ­¤é¡é ­è¢«é®è”½æˆ–æ•…éšœã€‚");

        } catch (e) {
            log("âŒ å•Ÿå‹•å¤±æ•—: " + e.message);
        }
    }
</script>
</body>
</html>

